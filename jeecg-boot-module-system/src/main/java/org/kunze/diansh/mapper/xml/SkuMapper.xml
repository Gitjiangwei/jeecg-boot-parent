<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.kunze.diansh.mapper.SkuMapper">

    <insert id="saveSku">
        insert into kz_sku(id,spu_id,title,images,new_price,price,indexes,own_spec,enable,create_time,last_update_time,update_name)
        values
        <foreach collection="skuList" item="item" separator=",">
            (#{item.id},#{item.spuId},#{item.title},#{item.images},#{item.newPrice},#{item.price},#{item.indexes},#{item.ownSpec},
            #{item.enable},NOW(),NOW(),#{item.updateName})
        </foreach>
    </insert>

    <update id="updateSku">
        update kz_sku
        <trim prefix="set" suffixOverrides=",">
            <foreach collection="skuList" item="sku" separator=",">
                <if test="sku.spuId !=null and sku.spuId != ''">spu_id=#{sku.spuId},</if>
                <if test="sku.title !=null and sku.title != ''">title=#{sku.title},</if>
                <if test="sku.images !=null and sku.images != ''">images=#{sku.images},</if>
                <if test="sku.newPrice !=null and sku.images != ''">images=#{sku.newPrice},</if>
                <if test="sku.price !=null and sku.price != ''">price=#{sku.price},</if>
                <if test="sku.indexes !=null and sku.indexes != ''">indexes=#{sku.indexes},</if>
                <if test="sku.ownSpec !=null and sku.ownSpec != ''">own_spec=#{sku.ownSpec},</if>
                <if test="sku.enable !=null and sku.enable != ''">enable=#{sku.enable},</if>
                <if test="sku.lastUpdateTime !=null and sku.lastUpdateTime != ''">last_update_time=NOW(),</if>
                <if test="sku.shopId !=null and sku.shopId != ''">shop_id=#{sku.shopId},</if>
                <if test="sku.updateName !=null and sku.updateName != ''">update_name=#{sku.updateName}</if>
            </foreach>
        </trim>
        where id in
        <foreach collection="skuList" index="index" item="sku" separator="," open="(" close=")">
            #{sku.id}
        </foreach>
    </update>

    <select id="querySkuById" resultType="org.kunze.diansh.entity.Sku">
        SELECT
	id,
	sku.spu_id,
	title,
	images,
	CASE sku.is_features
	WHEN '1' THEN
	feat.features_price
	ELSE
	sku.new_price
	END AS 'newPrice',
	price,
	indexes,
	own_spec,
	`enable`,
	sku.create_time,
	last_update_time,
	sku.shop_id,
	update_name,
	CASE sku.is_features
	WHEN '1' THEN
	'特卖'
	ELSE
	''
	END AS 'isFeatures'
FROM
	kz_sku sku
LEFT JOIN kz_spu_features feat ON sku.id = feat.sku_id
WHERE
	`enable` = 1
AND sku.spu_id = #{id}
    </select>

    <select id="querySkuBySpuId" resultType="org.kunze.diansh.entity.Sku">
      select id,sku.spu_id,title,images,new_price,
    CASE sku.is_features
	WHEN '1' THEN
	feat.features_price
	ELSE
	sku.new_price
	END AS 'newPrice',
	price,
      indexes,own_spec,`enable`,sku.create_time,last_update_time,sku.shop_id,update_name,
      	CASE sku.is_features
	WHEN '1' THEN
	'特卖'
	ELSE
	''
	END AS 'isFeatures'
        from kz_sku sku
        LEFT JOIN kz_spu_features feat ON sku.id = feat.sku_id
        where `enable`=1 and sku.spu_id = #{spuId}
    </select>
</mapper>